<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin="" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.Default.css" />

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/spin.js/2.3.2/spin.min.js"></script>

    <script src="https://unpkg.com/leaflet.markercluster@1.3.0/dist/leaflet.markercluster.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.24.0/axios.min.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/gh/kartenkarsten/leaflet-layer-overpass/blob/master/src/OverPassLayer.js"></script> -->

    <!-- <script src="./leaflet-layer-overpass-master/src/MinZoomIndicator.js"></script>
    <script src="./leaflet-layer-overpass-master/src/OverPassLayer.js"></script> -->



<style>
        #map {
            height: 600px;
        }
        #loading-spinner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <div id="loading-spinner"></div>
    <div id="sidebar">
        <p>TBD</p>
        <p>TBD</p>
    </div>
    <!-- <script src="app.js"></script> -->
    <!-- <script src="test.js"></script> -->
    <script src="./bower_components/leaflet-layer-overpass/dist/OverPassLayer.js"></script>
    <!-- <script src="./bower_components/leaflet-layer-overpass/dist/OverPassLayer.css"></script> -->
    <script src="./bower_components/leaflet/dist/leaflet.js"></script>
    <script src="./leaflet-layer-overpass-master/dist/OverPassLayer.js"></script>

    <script type="module">
        var attr_osm = 'Map data &copy; <a href="http://openstreetmap.org/">OpenStreetMap</a> contributors',
        attr_overpass = 'POI via <a href="http://www.overpass-api.de/">Overpass API</a>';
        var osm = new L.TileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {opacity: 0.7, attribution: [attr_osm, attr_overpass].join(', ')});

        var map = new L.Map('map').addLayer(osm).setView(new L.LatLng(40.7128, -74.0060), 14);
        //var mapBounds = L.latLngBounds([[40.90760337167582, -74.0111428691918],[40.91799662832418, -73.99985713080822]]);
        //map.fitBounds(mapBounds);

        //OverPassAPI overlay
        console.log('aaa');
        var lat = 40.7128;
        var lon = -74.0060;
        var icon = new L.Icon({
                iconUrl: 'leaf-green.png', //https://leafletjs.com/examples/custom-icons/leaf-green.png
                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                iconSize: [25, 41],
                iconAnchor: [12, 41],
                popupAnchor: [1, -34],
                shadowSize: [41, 41]
            });
        var opl = new L.OverPassLayer({
            query: "(node(BBOX)['amenity'='bench'];node(BBOX)['leisure'='picnic_table'];);out body;",
            //query: "node(BBOX)['amenity'='restaurant'];out;",
            markerIcon: icon,
            minZoom: 10,
            //query: 'node(around:100,' + lat + ',' + lon + ')["amenity"="restaurant"];out;',
            callback: function(data) {
                for(var i=0;i<data.elements.length;i++) {
                var e = data.elements[i];

                if (e.id in this.instance._ids) return;
                this.instance._ids[e.id] = true;
                var pos = new L.LatLng(e.lat, e.lon);
                var popup = this.instance._poiInfo(e.tags,e.id);
                var color = e.tags.collection_times ? 'green':'red';
                var circle = L.circle(pos, 50, {
                    color: color,
                    fillColor: '#fa3',
                    fillOpacity: 0.5
                })
                .bindPopup(popup);
                this.instance.addLayer(circle);
                }
            },
        });

        map.addLayer(opl);
        console.log('zzzzz');


    </script>
</body>
</html>
